{% extends "base.html" %}
{% block title %}–ú–æ—ë –∑–∞–º–µ—â–µ–Ω–∏–µ{% endblock %}

{% block content %}
<div class="container py-4">
  <h3 class="fw-bold mb-4">üîÅ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–º–µ—â–µ–Ω–∏–µ–º</h3>

  <!-- –ê–∫—Ç–∏–≤–Ω–æ–µ –∑–∞–º–µ—â–µ–Ω–∏–µ (–µ—Å–ª–∏ –ø–æ–ª–Ω–æ–º–æ—á–∏—è –ø–µ—Ä–µ–¥–∞–Ω—ã) -->
  {% if employee.is_frozen %}
  <div class="alert alert-warning border-start border-4 border-warning shadow-sm">
    <h5 class="fw-bold mb-2">‚ö†Ô∏è –í–∞—à–∏ –ø–æ–ª–Ω–æ–º–æ—á–∏—è –ø–µ—Ä–µ–¥–∞–Ω—ã</h5>
    <p class="mb-2">
      –í—ã –ø–µ—Ä–µ–¥–∞–ª–∏ —Å–≤–æ–∏ –ø–æ–ª–Ω–æ–º–æ—á–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É:
      <strong>{{ active_delegate.user.get_full_name|default:active_delegate.user.username }}</strong><br>
      –¥–æ <strong>{{ employee.delegate_until|date:"d.m.Y" }}</strong>.
    </p>
    <p class="small text-muted mb-3">
      –ü–æ–∫–∞ –∑–∞–º–µ—â–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ, —á–∞—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–π –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.
    </p>
    <form method="post">
      {% csrf_token %}
      <button name="cancel_delegation" class="btn btn-danger btn-sm">
        ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–º–µ—â–µ–Ω–∏–µ
      </button>
    </form>
  </div>
  {% endif %}

  <!-- –ï—Å–ª–∏ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–æ–≥–æ-—Ç–æ –∑–∞–º–µ—â–∞–µ—Ç -->
  {% if delegated_from %}
  <div class="alert alert-info border-start border-4 border-info shadow-sm">
    <h5 class="fw-bold mb-2">‚úÖ –í—ã –∑–∞–º–µ—â–∞–µ—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h5>
    <p>
      –°–µ–π—á–∞—Å –≤—ã –≤—ã–ø–æ–ª–Ω—è–µ—Ç–µ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏:
      <strong>{{ delegated_from.user.get_full_name|default:delegated_from.user.username }}</strong><br>
      –¥–æ <strong>{{ delegated_from.delegate_until|date:"d.m.Y" }}</strong>.
    </p>
  </div>
  {% endif %}

  <!-- –§–æ—Ä–º–∞ –ø–µ—Ä–µ–¥–∞—á–∏ –ø–æ–ª–Ω–æ–º–æ—á–∏–π -->
  <div class="card p-4 shadow-sm mt-4">
    <h5 class="fw-bold mb-3">üíº –ü–µ—Ä–µ–¥–∞—á–∞ –ø–æ–ª–Ω–æ–º–æ—á–∏–π –∫–æ–ª–ª–µ–≥–µ</h5>

    <form method="post">
      {% csrf_token %}
      <div class="mb-3">
        <label class="form-label fw-semibold">–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –∏–∑ –≤–∞—à–µ–≥–æ –æ—Ç–¥–µ–ª–∞</label>
        <select name="delegate_to" class="form-select" required>
          <option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ ‚Äî</option>
          {% for e in colleagues %}
          <option value="{{ e.id }}">
            {{ e.user.last_name }} {{ e.user.first_name }}
            {% if e.position %}({{ e.position }}){% endif %}
          </option>
          {% endfor %}
        </select>
      </div>

      <div class="mb-3">
        <label class="form-label fw-semibold">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∑–∞–º–µ—â–µ–Ω–∏—è</label>
        <input type="date" name="delegate_until" class="form-control" min="{% now 'Y-m-d' %}" required>
        <div class="form-text text-muted">–£–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É, –¥–æ –∫–æ—Ç–æ—Ä–æ–π –∑–∞–º–µ—â–∞—é—â–∏–π –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –≤–∞—à–∏ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏.</div>
      </div>

      <div class="d-flex justify-content-between align-items-center">
        <button type="submit" class="btn btn-primary">
          üíº –ü–µ—Ä–µ–¥–∞—Ç—å –ø–æ–ª–Ω–æ–º–æ—á–∏—è
        </button>
        {% if active_delegate %}
        <small class="text-muted">–¢–µ–∫—É—â–µ–µ –∑–∞–º–µ—â–µ–Ω–∏–µ: {{ active_delegate }}</small>
        {% endif %}
      </div>
    </form>
  </div>

  <!-- –°–ø–∏—Å–æ–∫ –∫–æ–ª–ª–µ–≥ -->
  <div class="card p-4 mt-4 shadow-sm">
    <h6 class="fw-bold mb-3">üë• –ö–æ–ª–ª–µ–≥–∏ –≤–∞—à–µ–≥–æ –æ—Ç–¥–µ–ª–∞</h6>
    {% if colleagues %}
      <table class="table table-sm align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>–§–ò–û</th>
            <th>–î–æ–ª–∂–Ω–æ—Å—Ç—å</th>
          </tr>
        </thead>
        <tbody>
          {% for e in colleagues %}
          <tr>
            <td>{{ e.user.last_name }} {{ e.user.first_name }}</td>
            <td>{{ e.position|default:"‚Äî" }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="text-muted">–ù–µ—Ç –∫–æ–ª–ª–µ–≥ –≤ –≤–∞—à–µ–º –æ—Ç–¥–µ–ª–µ.</p>
    {% endif %}
  </div>
</div>
{% endblock %}
